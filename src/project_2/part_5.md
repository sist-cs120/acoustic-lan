## CSMA/CD

In order to efficiently support multiple nodes in the shared communication medium, their transmissions should be carefully coordinated. There are many different MAC protocols. The one we choose in *Athernet* is CSMA, which is widely used in Ethernet and Wi-Fi.

**CSMA Protocol**. The intuition of CSMA protocol can be simply put as 'listen before talk'. The lecture and the textbook have covered it quite well. Below is the state machine of CSMA protocol. Check more information from references.

![CSMA ACK State Machine](/media/csma_ack_fsm.png)

**CSMA/CD**. Network performance is determined by many factors. High throughput physical layer does not necessarily indicate high network performance. To further increase the efficiency of CSMA protocol, PHY.Tx thread can be aborted if PHY.Rx thread indicates high power. The throughput should be higher when collision detection is enabled.

**Network with Jamming**. Using your accessories to connect 2 nodes like Part1, so the nodes are able to hear each other. Additionally, as shown in network topology, we introduce a jamming source to test the CSMA mechanism. Each node should be able to hear the output from the Jamming source, which intermittently plays high-power noise signals. The detailed parameters of the jamming source are coded in the JammingWav.m. Check them carefully to tune the parameters of the CSMA design. The key point is that, as CSMA is enabled in the two nodes, the communication should be able to work under the silent intervals of the Jamming source.

We go a little bit further about the figure below. First, the jamming signal is generated by a sound card. The signal is first split by a Tee and then merged with Rx signals of the nodes. The term 'merge' means a mix of two electronic waves. In the ideal case when the DC levels of these nodes are the same, 'merge' simply means sum or superposition. Second, another important implication is that node 1/2 can hear the signal generated by themselves. This is because the Tee is an undirected device. When the Tx signal by node 1 arrives at the Tee of node 2, it also is split and fed to the direction for the Jamming src. At the Tee of the Jamming src, that signal again split and final loop back to the Rx interface of node1. The same situation happens for the Tx signal of noted. I want to emphasize is that this is a feature rather than a bug of the topology. As when nodes can hear the transmission of themselves, there are no possibilities for full duplex implementations, which is why we use CSMA in early Ethernet and Wi-Fi.

### Devices
- NODE1: send 6250 bytes of data to NODE2.
- NODE2: send 5000 bytes of data to NODE1.
- Jamming source: intermitently play a high-power noise signal. (Provided by TAs)

![Jamming Topology](/media/jamming.png)

### Checkpoint 1
- Autograder generates random file `input1.bin` and `input2.bin` of size 6250 and 5000 bytes, respectively.
- TA starts by playing the jamming source.
- NODE1 initiates the transmission of 6250 bytes of data to NODE2.
- NODE2 initiates the transmission of 5000 bytes of data to NODE1. (immidiately after NODE1)
- NODE1 saves received data to `output2.bin`
- NODE2 saves received data to `output1.bin`
- **NODE2 should finish the transmission before NODE1.**
- **Data transmitted by both nodes should be error free.**
- Timing requirement

```sh
# On both nodes
autograder.py --random-bytes 6250 input1.bin
autograder.py --random-bytes 5000 input2.bin

# On NODE1
athernet --node 1 --send input1.bin --receive output2.bin
autograder.py --diff input2.bin output2.bin

# On NODE2
athernet --node 2 --send input2.bin --receive output1.bin
autograder.py --diff input1.bin output1.bin
```


| Transmission Time t | Percentage |
| ------------------- | ---------- |
| 0s < t < 60s        | 100%       |
| 60s < t < 90s       | 80%        |
| 90s < t < 120s      | 50%        |
| t > 120s            | 0%         |
